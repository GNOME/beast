# Beast Tests
#
## Makefile.am for BEAST audio tests

noinst_build_sources += beastconf.sh
beastconf.sh: Makefile
	cd . \
	&& echo "# Generated data from $< (by make $@)" > xgen-bp \
	&& echo >> xgen-bp \
	&& echo "BSE_VERSION=$(BSE_VERSION)" >> xgen-bp \
	&& echo "top_builddir=$(top_builddir)" >> xgen-bp \
	&& chmod 755 xgen-bp \
	&& (cp xgen-bp $@) \
	&& rm -f xgen-bp
CLEANFILES += beastconf.sh xgen-bp

test: beastconf.sh reset-summary
	@for ftest in $(FEATURE_TESTS) ; do \
		$(MAKE) -C . $(AM_MAKEFLAGS) $$ftest ; \
	done
	@featuretest.sh --summary
	@featuretest.sh --reset-summary
# in case featuretest.sh --summary fails
CLEANFILES += featuretest-summary.sh

reset-summary: beastconf.sh
	featuretest.sh --reset-summary

# files generated by feature tests
CLEANFILES += *.current *.bse.wav

FEATURE_TESTS = test-bseadder
test-bseadder: beastconf.sh
	@featuretest.sh bseadder.bse bseadder.reference \
	               --avg-spectrum --avg-energy \
	            -- --threshold=99.99
